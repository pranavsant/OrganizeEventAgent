export declare const ADAPTER_RUNTIME_SCRIPT = "var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nconst LATEST_PROTOCOL_VERSION = \"2025-11-21\";\nconst METHODS = {\n  // Lifecycle\n  INITIALIZE: \"ui/initialize\",\n  INITIALIZED: \"ui/notifications/initialized\",\n  // Tool data (Host -> Guest)\n  TOOL_INPUT: \"ui/notifications/tool-input\",\n  TOOL_INPUT_PARTIAL: \"ui/notifications/tool-input-partial\",\n  TOOL_RESULT: \"ui/notifications/tool-result\",\n  TOOL_CANCELLED: \"ui/notifications/tool-cancelled\",\n  // Context & UI\n  HOST_CONTEXT_CHANGED: \"ui/notifications/host-context-changed\",\n  SIZE_CHANGED: \"ui/notifications/size-changed\",\n  RESOURCE_TEARDOWN: \"ui/resource-teardown\",\n  // Standard MCP methods\n  TOOLS_CALL: \"tools/call\",\n  NOTIFICATIONS_MESSAGE: \"notifications/message\",\n  OPEN_LINK: \"ui/open-link\",\n  MESSAGE: \"ui/message\"\n};\nclass McpAppsAdapter {\n  constructor(config = {}) {\n    __publicField(this, \"config\");\n    __publicField(this, \"pendingRequests\", /* @__PURE__ */ new Map());\n    __publicField(this, \"messageIdCounter\", 0);\n    __publicField(this, \"originalPostMessage\", null);\n    __publicField(this, \"parentWindow\", null);\n    __publicField(this, \"hostCapabilities\", null);\n    __publicField(this, \"hostContext\", null);\n    __publicField(this, \"initialized\", false);\n    // Current render data state (similar to window.openai in Apps SDK)\n    __publicField(this, \"currentRenderData\", {});\n    this.config = {\n      logger: config.logger || console,\n      timeout: config.timeout || 3e4\n    };\n  }\n  install() {\n    this.parentWindow = window.parent;\n    this.config.logger.log(\"[MCP Apps Adapter] Checking parent window...\");\n    this.config.logger.log(\"[MCP Apps Adapter] window.parent exists:\", !!this.parentWindow);\n    this.config.logger.log(\n      \"[MCP Apps Adapter] window.parent === window:\",\n      this.parentWindow === window\n    );\n    if (!this.parentWindow || this.parentWindow === window) {\n      this.config.logger.warn(\n        \"[MCP Apps Adapter] No parent window detected. Adapter will not activate.\"\n      );\n      return false;\n    }\n    this.config.logger.log(\"[MCP Apps Adapter] Initializing adapter...\");\n    this.patchPostMessage();\n    window.addEventListener(\"message\", this.handleHostMessage.bind(this));\n    this.performInitialization();\n    this.config.logger.log(\"[MCP Apps Adapter] Adapter initialized successfully\");\n    return true;\n  }\n  /**\n   * Performs the MCP Apps SEP initialization handshake:\n   * 1. Send ui/initialize request with adapter info\n   * 2. Receive host capabilities and context\n   * 3. Send ui/notifications/initialized notification\n   * 4. Dispatch ready event to MCP-UI app\n   */\n  async performInitialization() {\n    const jsonRpcId = this.generateJsonRpcId();\n    const initPromise = new Promise((resolve, reject) => {\n      this.pendingRequests.set(String(jsonRpcId), {\n        messageId: \"init\",\n        type: \"init\",\n        resolve: (result) => {\n          const res = result;\n          this.hostCapabilities = res?.hostCapabilities ?? null;\n          this.hostContext = res?.hostContext ?? null;\n          this.initialized = true;\n          this.sendJsonRpcNotification(METHODS.INITIALIZED, {});\n          if (this.hostContext) {\n            if (this.hostContext.theme)\n              this.currentRenderData.theme = this.hostContext.theme;\n            if (this.hostContext.displayMode)\n              this.currentRenderData.displayMode = this.hostContext.displayMode;\n            if (this.hostContext.locale)\n              this.currentRenderData.locale = this.hostContext.locale;\n            const dims = this.hostContext.containerDimensions;\n            if (dims && \"maxHeight\" in dims && dims.maxHeight !== void 0)\n              this.currentRenderData.maxHeight = dims.maxHeight;\n          }\n          this.sendRenderData();\n          this.dispatchMessageToIframe({\n            type: \"ui-lifecycle-iframe-ready\"\n          });\n          resolve();\n        },\n        reject: (error) => {\n          this.config.logger.error(\"[MCP Apps Adapter] Initialization failed:\", error);\n          reject(error);\n        },\n        timeoutId: setTimeout(() => {\n          this.pendingRequests.delete(String(jsonRpcId));\n          this.config.logger.warn(\"[MCP Apps Adapter] Initialization timed out, proceeding anyway\");\n          this.dispatchMessageToIframe({\n            type: \"ui-lifecycle-iframe-ready\"\n          });\n          resolve();\n        }, this.config.timeout)\n      });\n    });\n    this.config.logger.log(\"[MCP Apps Adapter] Sending ui/initialize request with id:\", jsonRpcId);\n    this.sendJsonRpcRequest(jsonRpcId, METHODS.INITIALIZE, {\n      appInfo: {\n        name: \"mcp-ui-adapter\",\n        version: \"1.0.0\"\n      },\n      appCapabilities: {},\n      protocolVersion: LATEST_PROTOCOL_VERSION\n    });\n    this.config.logger.log(\"[MCP Apps Adapter] ui/initialize request sent\");\n    try {\n      await initPromise;\n    } catch (_error) {\n      this.config.logger.warn(\"[MCP Apps Adapter] Continuing despite initialization error\");\n    }\n  }\n  uninstall() {\n    for (const request of this.pendingRequests.values()) {\n      clearTimeout(request.timeoutId);\n      request.reject(new Error(\"Adapter uninstalled\"));\n    }\n    this.pendingRequests.clear();\n    if (this.originalPostMessage && this.parentWindow) {\n      try {\n        this.parentWindow.postMessage = this.originalPostMessage;\n        this.config.logger.log(\"[MCP Apps Adapter] Restored original parent.postMessage\");\n      } catch (error) {\n        this.config.logger.error(\n          \"[MCP Apps Adapter] Failed to restore original postMessage:\",\n          error\n        );\n      }\n    }\n    window.removeEventListener(\"message\", this.handleHostMessage.bind(this));\n    this.config.logger.log(\"[MCP Apps Adapter] Adapter uninstalled\");\n  }\n  patchPostMessage() {\n    this.originalPostMessage = this.parentWindow?.postMessage.bind(this.parentWindow) ?? null;\n    const postMessageInterceptor = (message, targetOriginOrOptions, transfer) => {\n      if (this.isMCPUIMessage(message)) {\n        const mcpMessage = message;\n        this.config.logger.debug(\"[MCP Apps Adapter] Intercepted MCP-UI message:\", mcpMessage.type);\n        this.handleMCPUIMessage(mcpMessage);\n      } else {\n        if (this.originalPostMessage) {\n          if (typeof targetOriginOrOptions === \"string\" || targetOriginOrOptions === void 0) {\n            const targetOrigin = targetOriginOrOptions ?? \"*\";\n            this.originalPostMessage(message, targetOrigin, transfer);\n          } else {\n            this.originalPostMessage(message, targetOriginOrOptions);\n          }\n        }\n      }\n    };\n    try {\n      if (this.parentWindow) {\n        this.parentWindow.postMessage = postMessageInterceptor;\n      }\n    } catch (error) {\n      this.config.logger.error(\n        \"[MCP Apps Adapter] Failed to monkey-patch parent.postMessage:\",\n        error\n      );\n    }\n  }\n  isMCPUIMessage(message) {\n    if (!message || typeof message !== \"object\") {\n      return false;\n    }\n    const msg = message;\n    return typeof msg.type === \"string\" && (msg.type.startsWith(\"ui-\") || [\"tool\", \"prompt\", \"intent\", \"notify\", \"link\"].includes(msg.type));\n  }\n  /**\n   * Handles messages coming from the Host (JSON-RPC) and translates them to MCP-UI messages\n   *\n   * MCP Apps SEP protocol methods (from @modelcontextprotocol/ext-apps):\n   * - ui/notifications/tool-input: Complete tool arguments\n   * - ui/notifications/tool-input-partial: Streaming partial tool arguments\n   * - ui/notifications/tool-result: Tool execution results\n   * - ui/notifications/host-context-changed: Theme, viewport, locale changes\n   * - ui/notifications/size-changed: Size change notifications (bidirectional)\n   * - ui/notifications/tool-cancelled: Tool execution was cancelled\n   * - ui/resource-teardown: Host notifies UI before teardown (request)\n   */\n  handleHostMessage(event) {\n    const data = event.data;\n    if (!data || typeof data !== \"object\" || !data.jsonrpc) {\n      return;\n    }\n    this.config.logger.debug(\"[MCP Apps Adapter] Received JSON-RPC message:\", data);\n    if (data.method) {\n      switch (data.method) {\n        case METHODS.TOOL_INPUT:\n          this.currentRenderData.toolInput = data.params?.arguments;\n          this.sendRenderData();\n          break;\n        case METHODS.TOOL_INPUT_PARTIAL:\n          this.currentRenderData.toolInput = data.params?.arguments;\n          this.sendRenderData();\n          break;\n        case METHODS.TOOL_RESULT:\n          this.currentRenderData.toolOutput = data.params;\n          this.sendRenderData();\n          break;\n        case METHODS.HOST_CONTEXT_CHANGED: {\n          if (data.params?.theme)\n            this.currentRenderData.theme = data.params.theme;\n          if (data.params?.displayMode)\n            this.currentRenderData.displayMode = data.params.displayMode;\n          if (data.params?.locale)\n            this.currentRenderData.locale = data.params.locale;\n          const contextDims = data.params?.containerDimensions;\n          if (contextDims && \"maxHeight\" in contextDims && contextDims.maxHeight !== void 0)\n            this.currentRenderData.maxHeight = contextDims.maxHeight;\n          this.sendRenderData();\n          break;\n        }\n        case METHODS.SIZE_CHANGED:\n          if (data.params?.height)\n            this.currentRenderData.maxHeight = data.params.height;\n          this.sendRenderData();\n          break;\n        case METHODS.TOOL_CANCELLED:\n          this.dispatchMessageToIframe({\n            type: \"ui-lifecycle-tool-cancelled\",\n            payload: {\n              reason: data.params?.reason\n            }\n          });\n          break;\n        case METHODS.RESOURCE_TEARDOWN:\n          this.dispatchMessageToIframe({\n            type: \"ui-lifecycle-teardown\",\n            payload: {\n              reason: data.params?.reason\n            }\n          });\n          if (data.id) {\n            this.sendJsonRpcResponse(data.id, {});\n          }\n          break;\n      }\n    } else if (data.id) {\n      const pendingRequest = this.pendingRequests.get(String(data.id));\n      if (pendingRequest) {\n        if (data.error) {\n          pendingRequest.reject(new Error(data.error.message));\n        } else {\n          pendingRequest.resolve(data.result);\n        }\n        this.pendingRequests.delete(String(data.id));\n        clearTimeout(pendingRequest.timeoutId);\n        this.dispatchMessageToIframe({\n          type: \"ui-message-response\",\n          messageId: pendingRequest.messageId,\n          // The original message ID from the App\n          payload: {\n            messageId: pendingRequest.messageId,\n            response: data.result,\n            error: data.error\n          }\n        });\n      }\n    }\n  }\n  /**\n   * Handles messages coming from the App (MCP-UI) and translates them to Host (JSON-RPC)\n   *\n   * MCP-UI message types translated to MCP Apps SEP:\n   * - 'tool' -> tools/call request\n   * - 'ui-size-change' -> ui/notifications/size-changed notification\n   * - 'notify' -> notifications/message notification (logging)\n   * - 'link' -> ui/open-link request\n   * - 'prompt' -> ui/message request\n   * - 'ui-lifecycle-iframe-ready' -> ui/notifications/initialized notification\n   */\n  async handleMCPUIMessage(message) {\n    const messageId = message.messageId || this.generateMessageId();\n    this.dispatchMessageToIframe({\n      type: \"ui-message-received\",\n      payload: { messageId }\n    });\n    try {\n      switch (message.type) {\n        case \"tool\": {\n          const { toolName, params } = message.payload;\n          const jsonRpcId = this.generateJsonRpcId();\n          this.pendingRequests.set(String(jsonRpcId), {\n            messageId,\n            type: \"tool\",\n            resolve: () => {\n            },\n            // Handled in handleHostMessage\n            reject: () => {\n            },\n            timeoutId: setTimeout(() => {\n              this.pendingRequests.delete(String(jsonRpcId));\n              this.dispatchMessageToIframe({\n                type: \"ui-message-response\",\n                messageId,\n                payload: { messageId, error: \"Timeout\" }\n              });\n            }, this.config.timeout)\n          });\n          this.sendJsonRpcRequest(jsonRpcId, METHODS.TOOLS_CALL, {\n            name: toolName,\n            arguments: params\n          });\n          break;\n        }\n        case \"ui-size-change\": {\n          const { width, height } = message.payload;\n          this.sendJsonRpcNotification(METHODS.SIZE_CHANGED, { width, height });\n          break;\n        }\n        case \"notify\": {\n          const { message: msg } = message.payload;\n          this.sendJsonRpcNotification(METHODS.NOTIFICATIONS_MESSAGE, {\n            level: \"info\",\n            data: msg\n          });\n          break;\n        }\n        case \"link\": {\n          const { url } = message.payload;\n          const jsonRpcId = this.generateJsonRpcId();\n          this.pendingRequests.set(String(jsonRpcId), {\n            messageId,\n            type: \"link\",\n            resolve: () => {\n            },\n            reject: () => {\n            },\n            timeoutId: setTimeout(() => {\n              this.pendingRequests.delete(String(jsonRpcId));\n              this.dispatchMessageToIframe({\n                type: \"ui-message-response\",\n                messageId,\n                payload: { messageId, error: \"Timeout\" }\n              });\n            }, this.config.timeout)\n          });\n          this.sendJsonRpcRequest(jsonRpcId, METHODS.OPEN_LINK, { url });\n          break;\n        }\n        case \"prompt\": {\n          const { prompt } = message.payload;\n          const jsonRpcId = this.generateJsonRpcId();\n          this.pendingRequests.set(String(jsonRpcId), {\n            messageId,\n            type: \"prompt\",\n            resolve: () => {\n            },\n            reject: () => {\n            },\n            timeoutId: setTimeout(() => {\n              this.pendingRequests.delete(String(jsonRpcId));\n              this.dispatchMessageToIframe({\n                type: \"ui-message-response\",\n                messageId,\n                payload: { messageId, error: \"Timeout\" }\n              });\n            }, this.config.timeout)\n          });\n          this.sendJsonRpcRequest(jsonRpcId, METHODS.MESSAGE, {\n            role: \"user\",\n            content: [{ type: \"text\", text: prompt }]\n          });\n          break;\n        }\n        case \"ui-lifecycle-iframe-ready\": {\n          this.sendJsonRpcNotification(METHODS.INITIALIZED, {});\n          this.sendRenderData();\n          break;\n        }\n        case \"ui-request-render-data\": {\n          this.sendRenderData(messageId);\n          break;\n        }\n        case \"intent\": {\n          const { intent, params } = message.payload;\n          const jsonRpcId = this.generateJsonRpcId();\n          this.pendingRequests.set(String(jsonRpcId), {\n            messageId,\n            type: \"intent\",\n            resolve: () => {\n            },\n            reject: () => {\n            },\n            timeoutId: setTimeout(() => {\n              this.pendingRequests.delete(String(jsonRpcId));\n              this.dispatchMessageToIframe({\n                type: \"ui-message-response\",\n                messageId,\n                payload: { messageId, error: \"Timeout\" }\n              });\n            }, this.config.timeout)\n          });\n          this.sendJsonRpcRequest(jsonRpcId, METHODS.MESSAGE, {\n            role: \"user\",\n            content: [\n              { type: \"text\", text: `Intent: ${intent}. Parameters: ${JSON.stringify(params)}` }\n            ]\n          });\n          break;\n        }\n      }\n    } catch (error) {\n      this.config.logger.error(\"[MCP Apps Adapter] Error handling message:\", error);\n      this.dispatchMessageToIframe({\n        type: \"ui-message-response\",\n        messageId,\n        payload: { messageId, error }\n      });\n    }\n  }\n  /**\n   * Send current render data to the MCP-UI app\n   * This mirrors the Apps SDK adapter's sendRenderData method\n   */\n  sendRenderData(requestMessageId) {\n    this.dispatchMessageToIframe({\n      type: \"ui-lifecycle-iframe-render-data\",\n      messageId: requestMessageId,\n      payload: {\n        renderData: {\n          toolInput: this.currentRenderData.toolInput,\n          toolOutput: this.currentRenderData.toolOutput,\n          widgetState: this.currentRenderData.widgetState,\n          locale: this.currentRenderData.locale,\n          theme: this.currentRenderData.theme,\n          displayMode: this.currentRenderData.displayMode,\n          maxHeight: this.currentRenderData.maxHeight\n        }\n      }\n    });\n  }\n  sendJsonRpcRequest(id, method, params) {\n    this.originalPostMessage?.(\n      {\n        jsonrpc: \"2.0\",\n        id,\n        method,\n        params\n      },\n      \"*\"\n    );\n  }\n  sendJsonRpcResponse(id, result) {\n    this.originalPostMessage?.(\n      {\n        jsonrpc: \"2.0\",\n        id,\n        result\n      },\n      \"*\"\n    );\n  }\n  sendJsonRpcNotification(method, params) {\n    this.originalPostMessage?.(\n      {\n        jsonrpc: \"2.0\",\n        method,\n        params\n      },\n      \"*\"\n    );\n  }\n  dispatchMessageToIframe(data) {\n    const event = new MessageEvent(\"message\", {\n      data,\n      origin: window.location.origin,\n      // Same origin since we are inside the iframe\n      source: window\n    });\n    window.dispatchEvent(event);\n  }\n  generateMessageId() {\n    return `adapter-${Date.now()}-${++this.messageIdCounter}`;\n  }\n  generateJsonRpcId() {\n    return ++this.messageIdCounter;\n  }\n}\nlet adapterInstance = null;\nfunction initAdapter(config) {\n  if (adapterInstance) {\n    console.warn(\"[MCP Apps Adapter] Adapter already initialized\");\n    return true;\n  }\n  adapterInstance = new McpAppsAdapter(config);\n  return adapterInstance.install();\n}\nfunction uninstallAdapter() {\n  if (adapterInstance) {\n    adapterInstance.uninstall();\n    adapterInstance = null;\n  }\n}\n";
//# sourceMappingURL=adapter-runtime.bundled.d.ts.map