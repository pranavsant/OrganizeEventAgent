{"version":3,"file":"useAutoGrowTextarea.js","sourceRoot":"","sources":["../../../src/hooks/useAutoGrowTextarea.tsx"],"names":[],"mappings":"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","sourcesContent":["import { type RefObject, useCallback, useEffect, useLayoutEffect, useRef } from \"react\"\n\nexport const useAutoGrowTextarea = (ref: RefObject<HTMLTextAreaElement | null>, value: string) => {\n  const lastScrollHeight = useRef<number>(0)\n  const lastWidth = useRef<number | null>(null)\n\n  const measureAndMutate = useCallback(\n    (textarea: HTMLTextAreaElement, controlledValue: string = \"\") => {\n      textarea.style.height = \"0px\"\n      const { scrollHeight, offsetHeight, offsetWidth, clientHeight } = textarea\n      const targetHeight = scrollHeight + (offsetHeight - clientHeight)\n      // @ts-expect-error -- This custom value is intentional\n      textarea.__autoGrowHeightValue = targetHeight\n      textarea.style.height = `${targetHeight}px`\n\n      if (\n        lastScrollHeight.current < scrollHeight &&\n        textarea.selectionEnd === controlledValue.length\n      ) {\n        textarea.scrollTop = scrollHeight\n      }\n      lastScrollHeight.current = textarea.scrollHeight\n      lastWidth.current = offsetWidth\n    },\n    [],\n  )\n\n  // Consumers pass us the value, which they are using as a controlled component.\n  // React will commit this value into the DOM before this hook is fired.\n  useLayoutEffect(() => {\n    const textarea = ref.current\n    if (!textarea) {\n      return\n    }\n\n    measureAndMutate(textarea, value)\n  }, [ref, value, measureAndMutate])\n\n  useEffect(() => {\n    const textarea = ref.current\n    if (!textarea) {\n      return\n    }\n\n    const observer = new ResizeObserver(() => {\n      const nextWidth = textarea.offsetWidth\n      // Only concerned with width changes that might affect the last measured height\n      if (lastWidth.current == null || nextWidth !== lastWidth.current) {\n        measureAndMutate(textarea, textarea.value)\n      }\n    })\n\n    observer.observe(textarea)\n\n    return () => {\n      observer.disconnect()\n    }\n  }, [ref, measureAndMutate])\n}\n\nexport const unsafeForceCalculateAutoGrowHeight = (textarea: HTMLTextAreaElement) => {\n  // Reset the height to baseline (min-height will apply)\n  textarea.style.height = \"0px\"\n  // scrollHeight does not account for border thickness, which we can\n  // calculate by comparing offset and client height.\n  const { scrollHeight, offsetHeight, clientHeight } = textarea\n  const targetHeight = scrollHeight + (offsetHeight - clientHeight)\n  // @ts-expect-error -- This custom value is intentional\n  textarea.__autoGrowHeightValue = targetHeight\n  textarea.style.height = `${targetHeight}px`\n}\n\nexport const getAutoGrowTextareaHeight = (textarea: HTMLTextAreaElement) =>\n  // @ts-expect-error -- Avoid unnecessary paints by reading stored height\n  textarea.__autoGrowHeightValue || textarea.clientHeight\n"]}