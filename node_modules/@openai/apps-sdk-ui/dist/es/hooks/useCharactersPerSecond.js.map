{"version":3,"file":"useCharactersPerSecond.js","sourceRoot":"","sources":["../../../src/hooks/useCharactersPerSecond.tsx"],"names":[],"mappings":"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","sourcesContent":["import { useEffect, useRef } from \"react\"\n\nconst MIN_TIME_DELTA = 10\nconst MIN_CHARS_DELTA = 1\nconst MAX_SAMPLES = 30\nconst OUTLIER_STD_DEVS = 2\n\nexport function useCharactersPerSecond(text: string, streaming: boolean): () => number {\n  const samplesRef = useRef<number[]>([])\n  const lastLengthRef = useRef(text.length)\n  const lastTimeRef = useRef(Date.now())\n\n  useEffect(() => {\n    if (!streaming) return\n\n    const now = Date.now()\n    const length = text.length\n    const charsDelta = length - lastLengthRef.current\n    const timeDelta = now - lastTimeRef.current\n    if (charsDelta < MIN_CHARS_DELTA || timeDelta < MIN_TIME_DELTA) return\n\n    const timeDeltaSeconds = timeDelta / 1000\n    const cps = charsDelta / timeDeltaSeconds\n\n    const samples = samplesRef.current\n    samples.push(cps)\n    if (samples.length > MAX_SAMPLES) samples.shift()\n\n    lastLengthRef.current = length\n    lastTimeRef.current = now\n  }, [text, streaming])\n\n  return () => {\n    const samples = samplesRef.current\n    const currentMean = mean(samples)\n    const currentStdDev = standardDeviation(samples, currentMean)\n\n    const filteredSamples = samples.filter((val) => {\n      const distance = Math.abs(val - currentMean)\n      return distance <= OUTLIER_STD_DEVS * currentStdDev\n    })\n\n    return mean(filteredSamples)\n  }\n}\n\nfunction mean(values: number[]): number {\n  if (!values.length) return 0\n  const sum = values.reduce((acc, val) => acc + val, 0)\n  return sum / values.length\n}\n\nfunction standardDeviation(values: number[], avg: number): number {\n  if (!values.length) return 0\n  const variance = values.reduce((acc, val) => acc + (val - avg) ** 2, 0) / values.length\n  return Math.sqrt(variance)\n}\n"]}