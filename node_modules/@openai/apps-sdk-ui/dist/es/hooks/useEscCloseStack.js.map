{"version":3,"file":"useEscCloseStack.js","sourceRoot":"","sources":["../../../src/hooks/useEscCloseStack.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,KAAK,EAAE,MAAM,OAAO,CAAA;AACxC,OAAO,EAAE,cAAc,EAAE,MAAM,kBAAkB,CAAA;AAOjD,IAAI,QAAQ,GAAc,EAAE,CAAA;AAC5B,IAAI,aAAa,GAAG,KAAK,CAAA;AAEzB,MAAM,aAAa,GAAG,CAAC,GAAkB,EAAE,EAAE;IAC3C,IAAI,GAAG,CAAC,GAAG,KAAK,QAAQ,EAAE,CAAC;QACzB,+DAA+D;QAC/D,MAAM,CAAC,YAAY,CAAC,GAAG,QAAQ,CAAA;QAE/B,IAAI,YAAY,EAAE,CAAC;YACjB,GAAG,CAAC,cAAc,EAAE,CAAA;YACpB,YAAY,CAAC,QAAQ,CAAC,OAAO,EAAE,EAAE,CAAA;QACnC,CAAC;IACH,CAAC;AACH,CAAC,CAAA;AAED,MAAM,eAAe,GAAG,GAAG,EAAE;IAC3B,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC;QAC1C,QAAQ,CAAC,IAAI,CAAC,gBAAgB,CAAC,SAAS,EAAE,aAAa,CAAC,CAAA;QACxD,aAAa,GAAG,IAAI,CAAA;IACtB,CAAC;SAAM,IAAI,QAAQ,CAAC,MAAM,KAAK,CAAC,IAAI,aAAa,EAAE,CAAC;QAClD,QAAQ,CAAC,IAAI,CAAC,mBAAmB,CAAC,SAAS,EAAE,aAAa,CAAC,CAAA;QAC3D,aAAa,GAAG,KAAK,CAAA;IACvB,CAAC;AACH,CAAC,CAAA;AAED,MAAM,eAAe,GAAG,CAAC,OAAgB,EAAE,EAAE;IAC3C,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;IACzB,eAAe,EAAE,CAAA;AACnB,CAAC,CAAA;AAED,MAAM,iBAAiB,GAAG,CAAC,EAAE,EAAE,EAAW,EAAE,EAAE;IAC5C,QAAQ,GAAG,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,CAAC,CAAA;IAC9C,eAAe,EAAE,CAAA;AACnB,CAAC,CAAA;AAED,MAAM,CAAC,MAAM,gBAAgB,GAAG,CAAC,SAAkB,EAAE,EAAc,EAAE,EAAE;IACrE,MAAM,EAAE,GAAG,KAAK,EAAE,CAAA;IAClB,MAAM,cAAc,GAAG,cAAc,CAAC,EAAE,CAAC,CAAA;IAEzC,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,CAAC,SAAS,EAAE,CAAC;YACf,OAAM;QACR,CAAC;QAED,MAAM,OAAO,GAAG,EAAE,EAAE,EAAE,QAAQ,EAAE,cAAc,EAAE,CAAA;QAChD,eAAe,CAAC,OAAO,CAAC,CAAA;QAExB,OAAO,GAAG,EAAE,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAA;IACzC,CAAC,EAAE,CAAC,EAAE,EAAE,SAAS,EAAE,cAAc,CAAC,CAAC,CAAA;AACrC,CAAC,CAAA","sourcesContent":["import { useEffect, useId } from \"react\"\nimport { useLatestValue } from \"./useLatestValue\"\n\ntype Handler = {\n  id: string\n  callback: React.MutableRefObject<() => void>\n}\n\nlet handlers: Handler[] = []\nlet listenerBound = false\n\nconst handleKeyDown = (evt: KeyboardEvent) => {\n  if (evt.key === \"Escape\") {\n    // Attempt to call the first handler in the stack, if it exists\n    const [firstHandler] = handlers\n\n    if (firstHandler) {\n      evt.preventDefault()\n      firstHandler.callback.current?.()\n    }\n  }\n}\n\nconst managerListener = () => {\n  if (handlers.length > 0 && !listenerBound) {\n    document.body.addEventListener(\"keydown\", handleKeyDown)\n    listenerBound = true\n  } else if (handlers.length === 0 && listenerBound) {\n    document.body.removeEventListener(\"keydown\", handleKeyDown)\n    listenerBound = false\n  }\n}\n\nconst registerHandler = (handler: Handler) => {\n  handlers.unshift(handler)\n  managerListener()\n}\n\nconst unregisterHandler = ({ id }: Handler) => {\n  handlers = handlers.filter((h) => h.id !== id)\n  managerListener()\n}\n\nexport const useEscCloseStack = (listening: boolean, cb: () => void) => {\n  const id = useId()\n  const latestCallback = useLatestValue(cb)\n\n  useEffect(() => {\n    if (!listening) {\n      return\n    }\n\n    const handler = { id, callback: latestCallback }\n    registerHandler(handler)\n\n    return () => unregisterHandler(handler)\n  }, [id, listening, latestCallback])\n}\n"]}