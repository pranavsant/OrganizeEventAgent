{"version":3,"file":"useTextSelection.js","sourceRoot":"","sources":["../../../src/hooks/useTextSelection.tsx"],"names":[],"mappings":"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","sourcesContent":["import { type RefObject, useEffect, useId } from \"react\"\nimport { canUseDOM } from \"../lib/environment\"\nimport { useLatestValue } from \"./useLatestValue\"\n\ntype Handler = {\n  id: string\n  callback: RefObject<(selection: Selection | null) => void>\n}\n\nlet handlers: Handler[] = []\nlet listenerBound = false\n\nconst handleSelectionChange = () => {\n  if (!canUseDOM) {\n    return\n  }\n\n  // Wait until the next tick\n  setTimeout(() => {\n    const selection = window.getSelection?.()\n    const selectionEmpty = !selection || selection.rangeCount === 0\n\n    handlers.forEach(({ callback }) => {\n      callback.current(selectionEmpty ? null : selection)\n    })\n  })\n}\n\nconst managerListener = () => {\n  if (!canUseDOM) {\n    return\n  }\n\n  if (handlers.length > 0 && !listenerBound) {\n    document.addEventListener(\"mouseup\", handleSelectionChange)\n    listenerBound = true\n  } else if (handlers.length === 0 && listenerBound) {\n    document.removeEventListener(\"mouseup\", handleSelectionChange)\n    listenerBound = false\n  }\n}\n\nconst registerHandler = (handler: Handler) => {\n  handlers.push(handler)\n  managerListener()\n}\n\nconst unregisterHandler = ({ id }: Handler) => {\n  handlers = handlers.filter((h) => h.id !== id)\n  managerListener()\n}\n\nexport const useTextSelection = (\n  listening: boolean,\n  cb: (currentSelection: Selection | null) => void,\n) => {\n  const id = useId()\n  const latestCallback = useLatestValue(cb)\n\n  useEffect(() => {\n    if (!listening) {\n      return\n    }\n\n    const handler = { id, callback: latestCallback }\n    registerHandler(handler)\n\n    return () => unregisterHandler(handler)\n  }, [id, listening, latestCallback])\n}\n\nexport const clearTextSelection = () => {\n  if (!canUseDOM) {\n    return\n  }\n\n  const selection = window.getSelection?.()\n\n  if (!selection || selection.type === \"None\") {\n    return\n  }\n\n  selection.removeAllRanges()\n}\n"]}