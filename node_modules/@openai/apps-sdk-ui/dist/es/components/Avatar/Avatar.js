"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { createElement as _createElement } from "react";
import clsx from "clsx";
import { useMemo, useState } from "react";
import { toCssVariables } from "../../lib/helpers";
import {} from "../../types";
import s from "./Avatar.module.css";
export const Avatar = (props) => {
    // Validate the image url before sending to the component
    const validImageUrl = validateImageUrl(props.imageUrl);
    // Keying off of imageUrl allows us to refresh imageStatus automatically through React rendering
    return _createElement(AvatarInner, { ...props, imageUrl: validImageUrl, key: validImageUrl });
};
export const AvatarInner = (props) => {
    const { className, size, overflowCount, name, color = "secondary", variant = "soft", imageUrl, Icon, 
    // asChild support
    ...restProps } = props;
    const [imageStatus, setImageStatus] = useState();
    const isInteractive = !!(restProps.onPointerDown || restProps.onClick);
    const TagName = isInteractive ? "button" : "span";
    return (_jsx(TagName, { className: clsx(s.Avatar, className), style: toCssVariables({
            "avatar-size": size,
        }), role: isInteractive ? undefined : "presentation", "data-color": color, "data-variant": variant, type: isInteractive ? "button" : undefined, ...restProps, children: (() => {
            if (imageUrl && imageStatus !== "error") {
                return (_jsx(AvatarImage, { status: imageStatus, url: imageUrl, onError: () => setImageStatus("error"), onLoad: () => setImageStatus("loaded") }));
            }
            if (Icon) {
                return _jsx(Icon, { className: s.AvatarIcon });
            }
            return overflowCount ? (_jsx(AvatarOverflowCount, { count: overflowCount })) : (_jsx(AvatarInitial, { name: name }));
        })() }));
};
const validateImageUrl = (imageUrl) => {
    if (!imageUrl) {
        return;
    }
    // Avoid specific pattern of images from gravatar.com, which use a pair of initials, instead of a single initial.
    if (imageUrl.includes("gravatar.com") && imageUrl.includes("cdn.auth0.com")) {
        return;
    }
    return imageUrl;
};
const AvatarImage = ({ url, status, onLoad, onError, }) => {
    return (_jsx("span", { className: s.AvatarImageContainer, children: _jsx("img", { src: url, className: s.AvatarImage, "data-loaded": status === "loaded" ? "" : undefined, onLoad: onLoad, onError: onError, alt: "", role: "presentation" }) }));
};
const AvatarInitial = ({ name = "" }) => {
    const firstInitial = useMemo(() => name.charAt(0).toUpperCase(), [name]);
    return _jsx("span", { className: s.AvatarInitial, children: firstInitial });
};
const AvatarOverflowCount = ({ count }) => {
    const formattedCount = useMemo(() => {
        return new Intl.NumberFormat("en", {
            notation: "compact",
            compactDisplay: "short",
            maximumFractionDigits: 0,
        })
            .format(count)
            .toLocaleLowerCase();
    }, [count]);
    return (_jsxs("span", { className: s.AvatarOverflowCount, "data-letter-count": formattedCount.length, children: [_jsx("span", { className: s.AvatarOverflowCountSymbol, children: "+" }), formattedCount] }));
};
//# sourceMappingURL=Avatar.js.map