{"version":3,"file":"Calendar.js","sourceRoot":"","sources":["../../../../src/components/DatePicker/Calendar.tsx"],"names":[],"mappings":"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","sourcesContent":["\"use client\"\n\nimport { DateTime, Interval } from \"luxon\"\nimport { useEffect, useMemo, useRef, useState } from \"react\"\nimport { chunkIntoWeeks, getDaysOfMonth, isBefore, isSameDay, isToday } from \"../../lib/dateUtils\"\nimport { waitForAnimationFrame } from \"../../lib/helpers\"\nimport { Button } from \"../Button\"\nimport { ChevronLeft, ChevronRight } from \"../Icon\"\nimport { usePopoverClose } from \"../Popover/usePopoverController\"\nimport { TransitionGroup } from \"../Transition\"\nimport s from \"./Calendar.module.css\"\nimport { useDateContext } from \"./context\"\n\nconst CALENDAR_WIDTH_PX = 210\nconst CALENDAR_GAP_PX = 32\nconst STEP_DISTANCE_PX = CALENDAR_WIDTH_PX + CALENDAR_GAP_PX\n\nexport const DateCalendar = () => {\n  const { value, min, max, onChangeRef } = useDateContext()\n  const closePopover = usePopoverClose()\n  const calendarContainerRef = useRef<HTMLDivElement | null>(null)\n  const [calendarSteps, setCalendarSteps] = useState<number>(0)\n  const [forceRenderIncrement, setForceRenderIncrement] = useState<number>(0)\n  const [calendarDate, setCalendarDate] = useState<DateTime>(() => value ?? DateTime.now())\n\n  const canGoBack = !min || isBefore(min, calendarDate.startOf(\"month\"))\n  const canGoForward = !max || isBefore(calendarDate.endOf(\"month\"), max)\n\n  const handleNext = () => {\n    setCalendarSteps((c) => c + 1)\n    setCalendarDate((dt) => dt.plus({ months: 1 }))\n  }\n\n  const handlePrevious = () => {\n    setCalendarSteps((c) => c - 1)\n    setCalendarDate((dt) => dt.minus({ months: 1 }))\n  }\n\n  const handleDateSelect = (selectedDate: DateTime) => {\n    onChangeRef.current(selectedDate)\n    closePopover()\n  }\n\n  // Force re-renders when `value` changes out of band from direct user-selection\n  useEffect(() => {\n    // No-op when value is empty\n    if (!value) {\n      return\n    }\n\n    // Check if `value` is still within view of our calendar\n    const viewInterval = Interval.fromDateTimes(\n      calendarDate.startOf(\"month\"),\n      calendarDate.endOf(\"month\"),\n    )\n    const isValueInRangeOfCalendar = viewInterval.contains(value)\n    if (!isValueInRangeOfCalendar) {\n      // Reset state the calendar view entirely\n      setCalendarSteps(0)\n      setCalendarDate(value)\n      setForceRenderIncrement((c) => c + 1)\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps -- Only re-run this hook when value changes\n  }, [value])\n\n  // Detect height changes when new calendars are rendered\n  useEffect(() => {\n    waitForAnimationFrame(() => {\n      const container = calendarContainerRef.current\n\n      if (!container) {\n        return\n      }\n\n      let maxHeight = -Infinity\n\n      // Find the tallest calendar\n      container.querySelectorAll(\"[data-calendar]\")?.forEach((element) => {\n        // NOTE: clientHeight does not respect the scale() that popover uses to animate in, which is what we want\n        // We want to know the full height of the element, without any transform applied.\n        const height = element.clientHeight\n\n        // Ignore calendars that are exiting\n        if (element.closest(\"[data-exiting\")) {\n          return\n        }\n\n        if (height > maxHeight) {\n          maxHeight = height\n        }\n      })\n\n      container.style.height = `${maxHeight}px`\n\n      // Don't animate the initial height.\n      // This is relevant when the calendar opens to a larger size than the default.\n      if (!container.style.transition) {\n        waitForAnimationFrame(() => {\n          container.style.transition = `height 0.25s var(--cubic-move)`\n        })\n      }\n    })\n  }, [calendarDate])\n\n  return (\n    <div className={s.CalendarWrapper} key={`stable-view-${forceRenderIncrement}`}>\n      <div ref={calendarContainerRef} className={s.CalendarContainer}>\n        <div className={s.Previous}>\n          <Button\n            variant=\"ghost\"\n            color=\"secondary\"\n            size=\"sm\"\n            gutterSize=\"2xs\"\n            pill={false}\n            iconSize=\"sm\"\n            onClick={handlePrevious}\n            disabled={!canGoBack}\n          >\n            <ChevronLeft />\n          </Button>\n        </div>\n        <div className={s.Next}>\n          <Button\n            variant=\"ghost\"\n            color=\"secondary\"\n            size=\"sm\"\n            gutterSize=\"2xs\"\n            pill={false}\n            iconSize=\"sm\"\n            onClick={handleNext}\n            disabled={!canGoForward}\n          >\n            <ChevronRight />\n          </Button>\n        </div>\n        <div\n          className={s.CalendarRange}\n          style={{\n            transform: `translate(${calendarSteps * -1 * STEP_DISTANCE_PX}px, 0)`,\n          }}\n        >\n          <TransitionGroup enterDuration={400} exitDuration={400}>\n            <CalendarView\n              key={calendarDate.toLocaleString({\n                month: \"long\",\n                year: \"numeric\",\n              })}\n              stepPosition={calendarSteps}\n              date={calendarDate}\n              selectedDate={value}\n              min={min}\n              max={max}\n              onDateSelect={handleDateSelect}\n            />\n          </TransitionGroup>\n        </div>\n      </div>\n    </div>\n  )\n}\n\ntype CalendarViewProps = {\n  // Can be any day within the given month that the calendar should render for\n  date: DateTime\n  selectedDate?: DateTime | null\n  onDateSelect?: (dt: DateTime) => void\n  min?: DateTime\n  max?: DateTime\n  stepPosition: number\n}\n\nconst daysOfTheWeekLabels = [\"Su\", \"Mo\", \"Tu\", \"We\", \"Th\", \"Fr\", \"Sa\"]\n\nconst CalendarView = ({\n  date,\n  selectedDate,\n  min,\n  max,\n  onDateSelect,\n  stepPosition,\n}: CalendarViewProps) => {\n  // Lock position on mount and don't respond to changes\n  const [position] = useState(stepPosition)\n  const { startOfMonth, weeks, enabledInterval } = useMemo(() => {\n    const monthStart = date.startOf(\"month\")\n    const endOfMonth = date.endOf(\"month\")\n\n    const daysBeforeMonthStart = monthStart.weekday % 7\n    const blankDays = new Array(daysBeforeMonthStart).fill(null)\n    const daysInMonth = getDaysOfMonth(monthStart)\n    const calendarCells = [...blankDays, ...daysInMonth]\n\n    const enabledDateInterval = Interval.fromDateTimes(min || monthStart, max || endOfMonth)\n\n    return {\n      startOfMonth: monthStart,\n      endOfMonth,\n      weeks: chunkIntoWeeks(calendarCells, 7),\n      enabledInterval: enabledDateInterval,\n    }\n  }, [date, min, max])\n\n  return (\n    <div className={s.Calendar} style={{ left: position * STEP_DISTANCE_PX }} data-calendar>\n      <p className={s.MonthLabel}>\n        {startOfMonth.monthLong} {startOfMonth.year}\n      </p>\n      <div className={s.Week}>\n        {daysOfTheWeekLabels.map((day) => (\n          <div key={day} className={s.DayLabel}>\n            {day}\n          </div>\n        ))}\n      </div>\n      {weeks.map((week, weekIndex) => (\n        <div className={s.Week} key={weekIndex}>\n          {week.map((d, dayIndex) => {\n            if (!d) {\n              return <div className={s.Day} key={`${weekIndex}-${dayIndex}`} />\n            }\n\n            const enabled = enabledInterval.contains(d)\n            const isSelected = enabled && selectedDate && isSameDay(d, selectedDate)\n            const dayIsToday = isToday(d)\n\n            return (\n              <div className={s.Day} key={dayIndex} data-is-selected={isSelected ? \"\" : undefined}>\n                <button\n                  className={s.InteractiveDay}\n                  disabled={!enabled}\n                  onClick={() => d && onDateSelect?.(d)}\n                >\n                  {d.day}\n                  {dayIsToday && <span className={s.TodayDot} />}\n                </button>\n              </div>\n            )\n          })}\n        </div>\n      ))}\n    </div>\n  )\n}\n"]}