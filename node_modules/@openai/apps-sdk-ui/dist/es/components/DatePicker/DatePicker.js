"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { DateTime } from "luxon";
import { useMemo } from "react";
import { useLatestValue } from "../../hooks/useLatestValue";
import { isBefore } from "../../lib/dateUtils";
import { Calendar } from "../Icon";
import { Popover } from "../Popover";
import { SelectControl } from "../SelectControl";
import { DateCalendar } from "./Calendar";
import { DateContext } from "./context";
export const DatePicker = (props) => {
    const { id, value, onChange, min, max, side = "bottom", sideOffset = 8, align = "center", alignOffset, variant = "outline", size = "md", clearable = false, disabled = false, dropdownIconType, placeholder = "Select date...", pill = true, block = false, triggerClassName, triggerShowIcon = true, triggerDateFormat = "MM/dd/yy", } = props;
    if (min && max && !isBefore(min, max)) {
        throw new Error("DatePicker error: `min` date must be before the `max` date");
    }
    // Create stable, mutable references to avoid memoization requirements from consumers
    const onChangeRef = useLatestValue(onChange);
    const store = useMemo(() => ({
        value,
        min,
        max,
        variant,
        size,
        dropdownIconType,
        clearable,
        disabled,
        placeholder,
        block,
        pill,
        triggerClassName,
        triggerShowIcon,
        triggerDateFormat,
        onChangeRef,
    }), [
        value,
        min,
        max,
        variant,
        size,
        dropdownIconType,
        clearable,
        disabled,
        placeholder,
        block,
        pill,
        triggerClassName,
        triggerShowIcon,
        triggerDateFormat,
        onChangeRef,
    ]);
    const handleClearClick = () => {
        onChangeRef.current(null);
    };
    return (_jsx(DateContext, { value: store, children: _jsxs(Popover, { children: [_jsx(Popover.Trigger, { children: _jsx(SelectControl, { id: id, className: triggerClassName, selected: !!value, variant: variant, pill: pill, block: block, size: size, disabled: disabled, StartIcon: triggerShowIcon ? Calendar : undefined, dropdownIconType: dropdownIconType, onClearClick: clearable ? handleClearClick : undefined, children: _jsx("span", { className: "tabular-nums", children: value?.toFormat(triggerDateFormat) ?? placeholder }) }) }), _jsx(Popover.Content, { minWidth: 230, side: side, sideOffset: sideOffset, align: align, alignOffset: alignOffset ?? (align === "center" ? 0 : -5), children: _jsx(DateCalendar, {}) })] }) }));
};
//# sourceMappingURL=DatePicker.js.map