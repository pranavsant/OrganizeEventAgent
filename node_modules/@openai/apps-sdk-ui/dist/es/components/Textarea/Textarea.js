"use client";
import { jsx as _jsx } from "react/jsx-runtime";
import clsx from "clsx";
import { useCallback, useEffect, useId, useRef, useState } from "react";
import { mergeRefs } from "react-merge-refs";
import { toCssVariables } from "../../lib/helpers";
import {} from "../../types";
import s from "./Textarea.module.css";
export const Textarea = (props) => {
    const textAreaRef = useRef(null);
    const inputIdSuffix = useId();
    // Prevent 1Password from appearing: 1Password won't display if it thinks this field is for searching
    // Allow user to override this for connecting to labels.
    const onePasswordPreventionId = `search-ui-input-${inputIdSuffix}`;
    const { id, name, variant = "outline", size = "md", gutterSize, className, autoComplete, disabled = false, readOnly = false, invalid = false, 
    // Default to `true` when presence of `name`
    allowAutofillExtensions = !!name, onFocus, onBlur, onAnimationStart, onAutofill, autoSelect, rows = 3, maxRows, autoResize, ref, onChange, ...restProps } = props;
    const [focused, setFocused] = useState(false);
    const computedMaxRows = autoResize ? Math.max(maxRows ?? 10, rows) : rows;
    useEffect(() => {
        if (autoSelect) {
            textAreaRef.current?.select();
        }
    }, [autoSelect]);
    const handleAnimationStart = (evt) => {
        onAnimationStart?.(evt);
        if (evt.animationName === "native-autofill-in") {
            onAutofill?.();
        }
    };
    const autosizeTextarea = useCallback(() => {
        if (!autoResize || !textAreaRef.current || computedMaxRows === undefined)
            return;
        textAreaRef.current.style.height = "0px";
        const scrollHeight = textAreaRef.current.scrollHeight;
        textAreaRef.current.style.height = scrollHeight + "px";
    }, [autoResize, computedMaxRows]);
    // Resize if value changes outside of user input - e.g. form reset
    useEffect(() => {
        autosizeTextarea();
    }, [props.value, rows, autosizeTextarea]);
    return (_jsx("div", { className: clsx(s.Container, className), "data-variant": variant, "data-size": size, "data-gutter-size": gutterSize, "data-focused": focused, "data-disabled": disabled ? "" : undefined, "data-readonly": readOnly ? "" : undefined, "data-invalid": invalid ? "" : undefined, style: toCssVariables({
            "textarea-min-rows": `${rows}`,
            "textarea-max-rows": `${computedMaxRows}`,
        }), children: _jsx("textarea", { ...restProps, onChange: (evt) => {
                onChange?.(evt);
                autosizeTextarea();
            }, ref: mergeRefs([textAreaRef, ref]), id: id || (allowAutofillExtensions ? undefined : onePasswordPreventionId), className: s.Textarea, name: name, readOnly: readOnly, disabled: disabled, rows: rows, onFocus: (evt) => {
                setFocused(true);
                onFocus?.(evt);
            }, onBlur: (evt) => {
                setFocused(false);
                onBlur?.(evt);
            }, onAnimationStart: handleAnimationStart, "data-lpignore": allowAutofillExtensions ? undefined : true, "data-1p-ignore": allowAutofillExtensions ? undefined : true }) }));
};
//# sourceMappingURL=Textarea.js.map