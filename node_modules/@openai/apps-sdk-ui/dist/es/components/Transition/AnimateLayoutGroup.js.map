{"version":3,"file":"AnimateLayoutGroup.js","sourceRoot":"","sources":["../../../../src/components/Transition/AnimateLayoutGroup.tsx"],"names":[],"mappings":"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","sourcesContent":["\"use client\"\n\nimport { TransitionGroup, type TransitionGroupProps } from \"./TransitionGroup\"\n\nimport clsx from \"clsx\"\nimport { type CSSProperties } from \"react\"\nimport {\n  toCssVariables,\n  toFilterProperty,\n  toMsDurationProperty,\n  toOpacityProperty,\n  toTransformProperty,\n  waitForAnimationFrame,\n} from \"../../lib/helpers\"\nimport s from \"./AnimateLayoutGroup.module.css\"\nimport {\n  type InitialTransitionDefinition,\n  type LayoutTransitionDefinition,\n  NonNullChildren,\n  type TransitionDefinition,\n} from \"./shared\"\n\nexport type AnimateLayoutGroupProps = Pick<\n  TransitionGroupProps,\n  \"as\" | \"children\" | \"className\" | \"insertMethod\" | \"preventInitialTransition\"\n> & {\n  /**\n   * Determines if `overflow: hidden` is applied to the wrapper element\n   * @default false\n   */\n  hideOverflow?: boolean\n  /**\n   * Determines which side of the container the items will pin to during enter/exit\n   * @default \"start\"\n   */\n  itemAnchor?: \"start\" | \"end\"\n  /**\n   * Determines which property will be animated during transitions\n   * @default \"height\"\n   */\n  dimension?: \"width\" | \"height\"\n  layoutEnter?: LayoutTransitionDefinition\n  layoutExit?: LayoutTransitionDefinition\n  layoutMove?: LayoutTransitionDefinition\n\n  enter?: TransitionDefinition\n  exit?: TransitionDefinition\n  initial?: InitialTransitionDefinition\n  /** Class applied to the inner TransitionGroup */\n  transitionClassName?: string\n  /**\n   * Applies `will-change` to force animating elements to composite layers. Use with caution!\n   * @default false\n   */\n  forceCompositeLayer?: boolean\n}\n\nexport const AnimateLayoutGroup = (props: AnimateLayoutGroupProps) => {\n  const {\n    as: TagName = \"span\",\n    children,\n    className,\n    transitionClassName,\n    dimension = \"height\",\n  } = props\n  const { enterTotalDuration, exitTotalDuration, variables } = getAnimationProperties(props)\n\n  const handleEnter = (element: HTMLDivElement) => {\n    // Stage zero layout\n    element.style[dimension] = \"0\"\n  }\n\n  const handleEnterActive = (element: HTMLDivElement) => {\n    waitForAnimationFrame(() => {\n      // Animate to target height\n      // IMPORTANT: Use clientHeight/clientWidth to measure children, in case they have scale() applied\n      const value =\n        dimension === \"width\"\n          ? element.firstElementChild?.clientWidth\n          : element.firstElementChild?.clientHeight\n\n      element.style[dimension] = `${value ?? 0}px`\n    })\n  }\n\n  const handleEnterComplete = (element: HTMLDivElement) => {\n    waitForAnimationFrame(() => {\n      // Restore natural layout to the DOM node\n      element.style[dimension] = \"\"\n    })\n  }\n\n  const handleExit = (element: HTMLDivElement) => {\n    element.style[dimension] = `${element.getBoundingClientRect()[dimension]}px`\n  }\n\n  const handleExitActive = (element: HTMLDivElement) => {\n    waitForAnimationFrame(() => {\n      // Animate to zero layout\n      element.style[dimension] = \"0\"\n    })\n  }\n\n  return (\n    <TransitionGroup\n      as={TagName}\n      className={clsx(s.LayoutItem, className)}\n      style={variables}\n      // Adding 32ms to timers because of the additional waitForAnimationFrame() calls\n      enterDuration={enterTotalDuration + 32}\n      exitDuration={exitTotalDuration + 32}\n      onEnter={handleEnter}\n      onEnterActive={handleEnterActive}\n      onEnterComplete={handleEnterComplete}\n      onExit={handleExit}\n      onExitActive={handleExitActive}\n    >\n      {NonNullChildren(children).map((child) => (\n        // Ensure any falsy child.key value is sent specifically as `undefined`.\n        // This ensures that key is not misinterpreted as a string 'null', 'false', etc.\n        <TagName\n          className={clsx(s.TransitionItem, transitionClassName)}\n          // @ts-expect-error Pass-through the validation of `key` to <TransitionGroup>\n          key={child.key || undefined}\n          data-dimension={dimension}\n        >\n          {child}\n        </TagName>\n      ))}\n    </TransitionGroup>\n  )\n}\n\n// Keep in sync with default values in AnimateLayout.module.css\nconst DEFAULT_LAYOUT_ENTER_DURATION_MS = 300\nconst DEFAULT_LAYOUT_ENTER_DELAY_MS = 0\nconst DEFAULT_LAYOUT_EXIT_DURATION_MS = 300\nconst DEFAULT_LAYOUT_EXIT_DELAY_MS = 50\nconst DEFAULT_LAYOUT_MOVE_DURATION_MS = 300\nconst DEFAULT_LAYOUT_MOVE_DELAY_MS = 0\nconst DEFAULT_ENTER_DURATION_MS_EASE = 400\nconst DEFAULT_ENTER_DURATION_MS_CUBIC = 400\nconst DEFAULT_ENTER_DELAY_MS = 150\nconst DEFAULT_EXIT_DURATION_MS_EASE = 200\nconst DEFAULT_EXIT_DURATION_MS_CUBIC = 300\nconst DEFAULT_EXIT_DELAY_MS = 0\n\nfunction getAnimationProperties({\n  initial,\n  enter,\n  exit,\n  forceCompositeLayer,\n  layoutEnter,\n  layoutExit,\n  layoutMove,\n}: AnimateLayoutGroupProps): {\n  enterTotalDuration: number\n  exitTotalDuration: number\n  variables: CSSProperties\n} {\n  // Dynamically inspect if we're transitioning transform properties, and apply cubic curves and timings as defaults\n  const initialTransform = toTransformProperty(initial)\n  const enterTransform = toTransformProperty(enter)\n  const exitTransform = toTransformProperty(exit)\n  const isCubicTransition = [initialTransform, exitTransform, enterTransform].some(\n    (t) => t !== \"none\",\n  )\n  const enterDuration =\n    enter?.duration ??\n    (isCubicTransition ? DEFAULT_ENTER_DURATION_MS_CUBIC : DEFAULT_ENTER_DURATION_MS_EASE)\n  const enterTimingFunction =\n    enter?.timingFunction ?? (isCubicTransition ? \"var(--cubic-enter)\" : \"ease\")\n  const exitDuration =\n    exit?.duration ??\n    (isCubicTransition ? DEFAULT_EXIT_DURATION_MS_CUBIC : DEFAULT_EXIT_DURATION_MS_EASE)\n  const exitTimingFunction =\n    exit?.timingFunction ?? (isCubicTransition ? \"var(--cubic-exit)\" : \"ease\")\n\n  // Generate variable overrides from props\n  const variables = toCssVariables({\n    \"tg-will-change\": forceCompositeLayer ? \"transform, opacity\" : \"auto\",\n    \"tg-enter-opacity\": toOpacityProperty(enter?.opacity ?? 1),\n    \"tg-enter-transform\": enterTransform,\n    \"tg-enter-filter\": toFilterProperty(enter ?? {}),\n    \"tg-enter-duration\": toMsDurationProperty(enterDuration),\n    \"tg-enter-delay\": toMsDurationProperty(enter?.delay ?? DEFAULT_ENTER_DELAY_MS),\n    \"tg-enter-timing-function\": enterTimingFunction,\n    \"tg-exit-opacity\": toOpacityProperty(exit?.opacity ?? 0),\n    \"tg-exit-transform\": exitTransform,\n    \"tg-exit-filter\": toFilterProperty(exit ?? {}),\n    \"tg-exit-duration\": toMsDurationProperty(exitDuration),\n    \"tg-exit-delay\": toMsDurationProperty(exit?.delay ?? DEFAULT_EXIT_DELAY_MS),\n    \"tg-exit-timing-function\": exitTimingFunction,\n    \"tg-initial-opacity\": toOpacityProperty(initial?.opacity ?? exit?.opacity ?? 0),\n    \"tg-initial-transform\": initialTransform === \"none\" ? exitTransform : initialTransform,\n    \"tg-initial-filter\": toFilterProperty(initial ?? exit ?? {}),\n    \"tg-layout-enter-duration\": toMsDurationProperty(\n      layoutEnter?.duration ?? DEFAULT_LAYOUT_ENTER_DURATION_MS,\n    ),\n    \"tg-layout-enter-delay\": toMsDurationProperty(\n      layoutEnter?.delay ?? DEFAULT_LAYOUT_ENTER_DELAY_MS,\n    ),\n    \"tg-layout-enter-timing-function\": layoutEnter?.timingFunction ?? \"var(--cubic-move)\",\n    \"tg-layout-exit-duration\": toMsDurationProperty(\n      layoutExit?.duration ?? DEFAULT_LAYOUT_EXIT_DURATION_MS,\n    ),\n    \"tg-layout-exit-delay\": toMsDurationProperty(layoutExit?.delay ?? DEFAULT_LAYOUT_EXIT_DELAY_MS),\n    \"tg-layout-exit-timing-function\": layoutExit?.timingFunction ?? \"var(--cubic-move)\",\n    \"tg-layout-move-duration\": toMsDurationProperty(\n      layoutMove?.duration ?? DEFAULT_LAYOUT_MOVE_DURATION_MS,\n    ),\n    \"tg-layout-move-delay\": toMsDurationProperty(\n      layoutMove?.delay ?? DEFAULT_LAYOUT_MOVE_DURATION_MS,\n    ),\n    \"tg-layout-move-timing-function\": layoutMove?.timingFunction ?? \"var(--cubic-move)\",\n  } satisfies Record<string, string>)\n\n  const enterTotalDuration =\n    (enter?.delay ?? DEFAULT_ENTER_DELAY_MS) + (enterDuration ?? DEFAULT_ENTER_DURATION_MS_EASE)\n  const exitTotalDuration =\n    (exit?.delay ?? DEFAULT_EXIT_DELAY_MS) + (exitDuration ?? DEFAULT_EXIT_DURATION_MS_EASE)\n  const layoutEnterTotalDuration =\n    (layoutEnter?.delay ?? DEFAULT_LAYOUT_ENTER_DELAY_MS) +\n    (layoutEnter?.duration ?? DEFAULT_LAYOUT_ENTER_DURATION_MS)\n  const layoutExitTotalDuration =\n    (layoutExit?.delay ?? DEFAULT_LAYOUT_EXIT_DELAY_MS) +\n    (layoutExit?.duration ?? DEFAULT_LAYOUT_EXIT_DURATION_MS)\n  const layoutMoveTotalDuration =\n    (layoutMove?.delay ?? DEFAULT_LAYOUT_MOVE_DELAY_MS) +\n    (layoutMove?.duration ?? DEFAULT_LAYOUT_MOVE_DURATION_MS)\n\n  return {\n    // In order for us to release layout dimensions (e.g., height) to the natural DOM state,\n    // we must ensure the behaviors from the TransitionGroup callbacks are synced with the outer layout `transitions`.\n    // Setting TransitionGroup timing to the max of these durations is the simplest approach.\n    // In practice, these should only vary by about 50-200ms at most; imperceivable to end-users.\n    enterTotalDuration: Math.max(\n      enterTotalDuration,\n      layoutEnterTotalDuration,\n      layoutMoveTotalDuration,\n    ),\n    exitTotalDuration: Math.max(\n      exitTotalDuration,\n      layoutExitTotalDuration,\n      layoutMoveTotalDuration,\n    ),\n    variables,\n  }\n}\n"]}