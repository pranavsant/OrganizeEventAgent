import { useEffect, useState } from "react";
import ReactMarkdown from "react-markdown";
const DEFAULT_EMPTY_STATE = { remarkPlugins: [], rehypePlugins: [] };
let resolvedPluginsCache = null;
let pluginLoadPromise = null;
async function loadMathDeps() {
    if (resolvedPluginsCache)
        return resolvedPluginsCache;
    if (pluginLoadPromise)
        return pluginLoadPromise;
    pluginLoadPromise = (async () => {
        const [{ default: remarkMath }, { default: rehypeKatex }] = await Promise.all([
            import("remark-math"),
            import("rehype-katex"),
        ]);
        resolvedPluginsCache = {
            remarkPlugins: [[remarkMath, { singleDollarTextMath: false }]],
            rehypePlugins: [rehypeKatex],
        };
        return resolvedPluginsCache;
    })();
    try {
        const plugins = await pluginLoadPromise;
        return plugins;
    }
    catch (err) {
        // Reset so a later attempt can retry
        pluginLoadPromise = null;
        throw err;
    }
}
export function useMathPlugins(enabled) {
    const [ready, setReady] = useState(!!resolvedPluginsCache);
    useEffect(() => {
        if (!enabled || ready) {
            return;
        }
        let alive = true;
        loadMathDeps()
            .then(() => {
            if (alive) {
                // Force re-render once we have the updated plugins
                setReady(true);
            }
        })
            .catch(() => { });
        return () => {
            alive = false;
        };
    }, [enabled, ready]);
    return ready && enabled && !!resolvedPluginsCache ? resolvedPluginsCache : DEFAULT_EMPTY_STATE;
}
//# sourceMappingURL=useMathPlugins.js.map