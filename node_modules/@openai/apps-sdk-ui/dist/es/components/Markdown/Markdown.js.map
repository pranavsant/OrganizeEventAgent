{"version":3,"file":"Markdown.js","sourceRoot":"","sources":["../../../../src/components/Markdown/Markdown.tsx"],"names":[],"mappings":"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","sourcesContent":["\"use client\"\n\nimport clsx from \"clsx\"\nimport { Children, useMemo, type ComponentProps, type FC, type ReactNode } from \"react\"\nimport ReactMarkdown from \"react-markdown\"\nimport remarkBreaks from \"remark-breaks\"\nimport remarkDirective from \"remark-directive\"\nimport remarkGfm from \"remark-gfm\"\n\nimport { CodeBlock, CodeBlockBase } from \"../CodeBlock/CodeBlock\"\nimport { TextLink } from \"../TextLink/TextLink\"\nimport { reactMarkdownRemarkDirective, type MarkdownDirective } from \"./directives\"\nimport s from \"./Markdown.module.css\"\nimport { defaultUrlTransform } from \"./urlTransform\"\nimport { useMathPlugins } from \"./useMathPlugins\"\nimport { useParseMarkdownPre } from \"./useParseMarkdownPre\"\n\nconst supportsLookbehind = (() => {\n  try {\n    new RegExp(\"(?<=a)b\")\n    return true\n  } catch {\n    return false\n  }\n})()\n\nexport type MarkdownComponent = FC<{\n  children?: ReactNode\n  className?: string\n  node: Record<string, unknown>\n}>\n\nexport type MarkdownProps = {\n  children: string\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  directives?: MarkdownDirective<any>[]\n  /** Determines if remark-math plugins should be loaded for rendering LaTeX */\n  includeMath?: boolean\n  /** Determines whether single newlines should insert <br> tags */\n  breakNewLines?: boolean\n  components?: Record<string, MarkdownComponent>\n  remarkPlugins?: ComponentProps<typeof ReactMarkdown>[\"remarkPlugins\"]\n  rehypePlugins?: ComponentProps<typeof ReactMarkdown>[\"rehypePlugins\"]\n  allowedElements?: ComponentProps<typeof ReactMarkdown>[\"allowedElements\"]\n  disallowedElements?: ComponentProps<typeof ReactMarkdown>[\"disallowedElements\"]\n  urlTransform?: ComponentProps<typeof ReactMarkdown>[\"urlTransform\"]\n  skipHtml?: boolean\n  className?: string\n  copyableCodeBlocks?: boolean\n}\n\nexport function Markdown({\n  children,\n  directives,\n  includeMath = false,\n  breakNewLines = false,\n  components: propsComponents,\n  remarkPlugins,\n  rehypePlugins,\n  allowedElements,\n  disallowedElements,\n  skipHtml,\n  urlTransform = defaultUrlTransform,\n  className,\n  copyableCodeBlocks = true,\n}: MarkdownProps) {\n  const mathPlugins = useMathPlugins(includeMath)\n  const baseComponents = {\n    ...COMMON_COMPONENTS,\n    ...(copyableCodeBlocks ? null : NON_COPYABLE_CODE_BLOCK_COMPONENTS),\n    ...propsComponents,\n  }\n  const components =\n    directives?.reduce((acc, directive) => {\n      acc[directive.directiveName] = directive.render\n      return acc\n    }, baseComponents) ?? baseComponents\n\n  const mergedRemarkPlugins = useMemo(() => {\n    const baseRemarkPlugins = [\n      remarkDirective,\n      reactMarkdownRemarkDirective,\n      ...mathPlugins.remarkPlugins,\n    ]\n\n    if (breakNewLines) {\n      baseRemarkPlugins.push(remarkBreaks)\n    }\n\n    // remark-gfm requires lookbehind support, which will throw in <= Safari 16.4\n    // with no easily available polyfill.\n    if (supportsLookbehind) {\n      // Do not treat single tilde as strikethrough to allow for more\n      // conversational use cases such as \"~$20-$30\"\n      baseRemarkPlugins.push([remarkGfm, { singleTilde: false }])\n    }\n\n    return [...baseRemarkPlugins, ...(remarkPlugins ?? [])]\n  }, [mathPlugins.remarkPlugins, remarkPlugins, breakNewLines])\n\n  return (\n    <ReactMarkdown\n      className={clsx(s.MarkdownContent, className)}\n      remarkPlugins={mergedRemarkPlugins}\n      rehypePlugins={[...(rehypePlugins ?? []), ...mathPlugins.rehypePlugins]}\n      components={components}\n      allowedElements={allowedElements}\n      disallowedElements={disallowedElements}\n      skipHtml={skipHtml}\n      urlTransform={urlTransform}\n    >\n      {children}\n    </ReactMarkdown>\n  )\n}\n\nconst Pre: MarkdownComponent = ({ children, className }) => {\n  const { code, language } = useParseMarkdownPre(children)\n  return (\n    <CodeBlock language={language} className={className}>\n      {code}\n    </CodeBlock>\n  )\n}\n\nconst InlineCode: MarkdownComponent = ({ children, className }) => (\n  <code className={clsx(s.InlineCode, className)}>{children}</code>\n)\n\nconst Anchor: MarkdownComponent = ({ children, node: _node, ...props }) => (\n  <TextLink as=\"a\" {...props}>\n    {children}\n  </TextLink>\n)\n\n// Sourced from ChatGPT\nconst TableCell: MarkdownComponent = ({ node: _node, children, ...rest }) => {\n  return (\n    <td {...rest}>\n      {Children.map(children, (child, i) =>\n        // ReactMarkdown does not support <br> tags in tables without using\n        // remark-html (which may not be safe), so we need to manually handle them\n        child === \"<br>\" ? <br key={i} /> : child,\n      )}\n    </td>\n  )\n}\n\nconst COMMON_COMPONENTS: Record<string, MarkdownComponent> = {\n  code: InlineCode,\n  pre: Pre,\n  a: Anchor,\n  td: TableCell,\n}\n\nconst NonCopyableCodeBlock: MarkdownComponent = ({ children, className }) => {\n  const { code, language } = useParseMarkdownPre(children)\n  return (\n    <CodeBlockBase className={className}>\n      <CodeBlockBase.Code language={language}>{code}</CodeBlockBase.Code>\n    </CodeBlockBase>\n  )\n}\n\nconst NON_COPYABLE_CODE_BLOCK_COMPONENTS: Record<string, MarkdownComponent> = {\n  pre: NonCopyableCodeBlock,\n} as const\n"]}