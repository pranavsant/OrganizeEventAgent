{"version":3,"file":"useMathPlugins.js","sourceRoot":"","sources":["../../../../src/components/Markdown/useMathPlugins.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAuB,MAAM,OAAO,CAAA;AAChE,OAAO,aAAa,MAAM,gBAAgB,CAAA;AAO1C,MAAM,mBAAmB,GAAG,EAAE,aAAa,EAAE,EAAE,EAAE,aAAa,EAAE,EAAE,EAAE,CAAA;AACpE,IAAI,oBAAoB,GAAuB,IAAI,CAAA;AAEnD,IAAI,iBAAiB,GAAgC,IAAI,CAAA;AAEzD,KAAK,UAAU,YAAY;IACzB,IAAI,oBAAoB;QAAE,OAAO,oBAAoB,CAAA;IACrD,IAAI,iBAAiB;QAAE,OAAO,iBAAiB,CAAA;IAE/C,iBAAiB,GAAG,CAAC,KAAK,IAAI,EAAE;QAC9B,MAAM,CAAC,EAAE,OAAO,EAAE,UAAU,EAAE,EAAE,EAAE,OAAO,EAAE,WAAW,EAAE,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;YAC5E,MAAM,CAAC,aAAa,CAAC;YACrB,MAAM,CAAC,cAAc,CAAC;SACvB,CAAC,CAAA;QAEF,oBAAoB,GAAG;YACrB,aAAa,EAAE,CAAC,CAAC,UAAU,EAAE,EAAE,oBAAoB,EAAE,KAAK,EAAE,CAAC,CAAC;YAC9D,aAAa,EAAE,CAAC,WAAW,CAAC;SAC7B,CAAA;QACD,OAAO,oBAAoB,CAAA;IAC7B,CAAC,CAAC,EAAE,CAAA;IAEJ,IAAI,CAAC;QACH,MAAM,OAAO,GAAG,MAAM,iBAAiB,CAAA;QACvC,OAAO,OAAO,CAAA;IAChB,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACb,qCAAqC;QACrC,iBAAiB,GAAG,IAAI,CAAA;QACxB,MAAM,GAAG,CAAA;IACX,CAAC;AACH,CAAC;AAED,MAAM,UAAU,cAAc,CAAC,OAAgB;IAC7C,MAAM,CAAC,KAAK,EAAE,QAAQ,CAAC,GAAG,QAAQ,CAAU,CAAC,CAAC,oBAAoB,CAAC,CAAA;IAEnE,SAAS,CAAC,GAAG,EAAE;QACb,IAAI,CAAC,OAAO,IAAI,KAAK,EAAE,CAAC;YACtB,OAAM;QACR,CAAC;QAED,IAAI,KAAK,GAAG,IAAI,CAAA;QAChB,YAAY,EAAE;aACX,IAAI,CAAC,GAAG,EAAE;YACT,IAAI,KAAK,EAAE,CAAC;gBACV,mDAAmD;gBACnD,QAAQ,CAAC,IAAI,CAAC,CAAA;YAChB,CAAC;QACH,CAAC,CAAC;aACD,KAAK,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAA;QAElB,OAAO,GAAG,EAAE;YACV,KAAK,GAAG,KAAK,CAAA;QACf,CAAC,CAAA;IACH,CAAC,EAAE,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAA;IAEpB,OAAO,KAAK,IAAI,OAAO,IAAI,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,mBAAmB,CAAA;AAChG,CAAC","sourcesContent":["import { useEffect, useState, type ComponentProps } from \"react\"\nimport ReactMarkdown from \"react-markdown\"\n\ntype MathPlugins = {\n  remarkPlugins: NonNullable<ComponentProps<typeof ReactMarkdown>[\"remarkPlugins\"]>\n  rehypePlugins: NonNullable<ComponentProps<typeof ReactMarkdown>[\"rehypePlugins\"]>\n}\n\nconst DEFAULT_EMPTY_STATE = { remarkPlugins: [], rehypePlugins: [] }\nlet resolvedPluginsCache: MathPlugins | null = null\n\nlet pluginLoadPromise: Promise<MathPlugins> | null = null\n\nasync function loadMathDeps(): Promise<MathPlugins> {\n  if (resolvedPluginsCache) return resolvedPluginsCache\n  if (pluginLoadPromise) return pluginLoadPromise\n\n  pluginLoadPromise = (async () => {\n    const [{ default: remarkMath }, { default: rehypeKatex }] = await Promise.all([\n      import(\"remark-math\"),\n      import(\"rehype-katex\"),\n    ])\n\n    resolvedPluginsCache = {\n      remarkPlugins: [[remarkMath, { singleDollarTextMath: false }]],\n      rehypePlugins: [rehypeKatex],\n    }\n    return resolvedPluginsCache\n  })()\n\n  try {\n    const plugins = await pluginLoadPromise\n    return plugins\n  } catch (err) {\n    // Reset so a later attempt can retry\n    pluginLoadPromise = null\n    throw err\n  }\n}\n\nexport function useMathPlugins(enabled: boolean) {\n  const [ready, setReady] = useState<boolean>(!!resolvedPluginsCache)\n\n  useEffect(() => {\n    if (!enabled || ready) {\n      return\n    }\n\n    let alive = true\n    loadMathDeps()\n      .then(() => {\n        if (alive) {\n          // Force re-render once we have the updated plugins\n          setReady(true)\n        }\n      })\n      .catch(() => {})\n\n    return () => {\n      alive = false\n    }\n  }, [enabled, ready])\n\n  return ready && enabled && !!resolvedPluginsCache ? resolvedPluginsCache : DEFAULT_EMPTY_STATE\n}\n"]}