import {
  registerInspectorRoutes
} from "./chunk-JNAYXSVD.js";
import "./chunk-IZPEEN7F.js";
import {
  isPortAvailable,
  parsePortFromArgs
} from "./chunk-O7EUTZ5E.js";
import "./chunk-CVECQ7BJ.js";
import {
  registerStaticRoutesWithDevProxy
} from "./chunk-S2MXUMF5.js";
import "./chunk-4CQ52PTY.js";
import "./chunk-IDMHJUEM.js";
import "./chunk-PKBMQBKP.js";

// src/server/server.ts
import { serve } from "@hono/node-server";
import { Hono } from "hono";
import { cors } from "hono/cors";
import { logger } from "hono/logger";
import open from "open";
var app = new Hono();
app.use(
  "*",
  cors({
    origin: "*",
    exposeHeaders: ["*"]
    // Expose all headers since this is a proxy
  })
);
app.use("/inspector/api/*", logger());
registerInspectorRoutes(app);
registerStaticRoutesWithDevProxy(app);
async function startServer() {
  try {
    const isDev = process.env.NODE_ENV === "development" || process.env.VITE_DEV === "true";
    const cliPort = parsePortFromArgs();
    let port = cliPort ?? (isDev ? 3001 : 3e3);
    const available = await isPortAvailable(port);
    if (!available) {
      if (cliPort !== null) {
        console.error(
          `\u274C Port ${port} is not available. Please stop the process using this port and try again.`
        );
        process.exit(1);
      }
      if (isDev) {
        console.error(
          `\u274C\u274C\u274C Port ${port} is not available (probably used by Vite dev server as fallback so you should stop port 3000). Please stop the process using this port and try again.`
        );
        process.exit(1);
      } else {
        const fallbackPort = 3002;
        console.warn(
          `\u26A0\uFE0F  Port ${port} is not available, trying ${fallbackPort}`
        );
        const fallbackAvailable = await isPortAvailable(fallbackPort);
        if (!fallbackAvailable) {
          console.error(
            `\u274C Neither port ${port} nor ${fallbackPort} is available. Please stop the processes using these ports and try again.`
          );
          process.exit(1);
        }
        port = fallbackPort;
      }
    }
    serve({
      fetch: app.fetch,
      port
    });
    if (isDev) {
      console.warn(
        `\u{1F680} MCP Inspector API server running on http://localhost:${port}`
      );
      console.warn(
        `\u{1F310} Vite dev server should be running on http://localhost:3000`
      );
    } else {
      console.warn(`\u{1F680} MCP Inspector running on http://localhost:${port}`);
    }
    if (process.env.NODE_ENV !== "production") {
      try {
        const url = isDev ? "http://localhost:3000" : `http://localhost:${port}`;
        await open(url);
        console.warn(`\u{1F310} Browser opened automatically`);
      } catch {
        const url = isDev ? "http://localhost:3000" : `http://localhost:${port}`;
        console.warn(`\u{1F310} Please open ${url} in your browser`);
      }
    }
    return { port, fetch: app.fetch };
  } catch (error) {
    console.error("Failed to start server:", error);
    process.exit(1);
  }
}
if (import.meta.url === `file://${process.argv[1]}`) {
  startServer();
}
var server_default = { startServer };
export {
  server_default as default
};
