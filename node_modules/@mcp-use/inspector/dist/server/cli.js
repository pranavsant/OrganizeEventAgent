#!/usr/bin/env node
import {
  registerInspectorRoutes
} from "./chunk-JNAYXSVD.js";
import "./chunk-IZPEEN7F.js";
import {
  findAvailablePort,
  isValidUrl
} from "./chunk-O7EUTZ5E.js";
import "./chunk-CVECQ7BJ.js";
import {
  registerStaticRoutes
} from "./chunk-S2MXUMF5.js";
import "./chunk-4CQ52PTY.js";
import "./chunk-IDMHJUEM.js";
import "./chunk-PKBMQBKP.js";

// src/server/cli.ts
import { serve } from "@hono/node-server";
import { Hono } from "hono";
import { cors } from "hono/cors";
import { logger } from "hono/logger";
import open from "open";
var args = process.argv.slice(2);
var mcpUrl;
var startPort = 8080;
for (let i = 0; i < args.length; i++) {
  if (args[i] === "--url" && i + 1 < args.length) {
    const url = args[i + 1];
    if (!isValidUrl(url)) {
      console.error(`Error: Invalid URL format: ${url}`);
      console.error("URL must start with http://, https://, ws://, or wss://");
      process.exit(1);
    }
    mcpUrl = url;
    i++;
  } else if (args[i] === "--port" && i + 1 < args.length) {
    const parsedPort = Number.parseInt(args[i + 1], 10);
    if (Number.isNaN(parsedPort) || parsedPort < 1 || parsedPort > 65535) {
      console.error(
        `Error: Port must be a number between 1 and 65535, got: ${args[i + 1]}`
      );
      process.exit(1);
    }
    startPort = parsedPort;
    i++;
  } else if (args[i] === "--help" || args[i] === "-h") {
    console.log(`
MCP Inspector - Inspect and debug MCP servers

Usage:
  npx @mcp-use/inspector [options]

Options:
  --url <url>    MCP server URL to auto-connect to (e.g., http://localhost:3000/mcp)
  --port <port>  Starting port to try (default: 8080, will find next available)
  --help, -h     Show this help message

Examples:
  # Run inspector with auto-connect
  npx @mcp-use/inspector --url http://localhost:3000/mcp

  # Run starting from custom port
  npx @mcp-use/inspector --url http://localhost:3000/mcp --port 9000

  # Run without auto-connect
  npx @mcp-use/inspector
`);
    process.exit(0);
  }
}
var app = new Hono();
app.use(
  "*",
  cors({
    origin: "*",
    exposeHeaders: ["*"]
    // Expose all headers since this is a proxy
  })
);
app.use("/inspector/api/proxy/*", logger());
registerInspectorRoutes(app, { autoConnectUrl: mcpUrl });
registerStaticRoutes(app);
async function startServer() {
  try {
    const port = await findAvailablePort(startPort);
    serve({
      fetch: app.fetch,
      port
    });
    console.log(`\u{1F680} MCP Inspector running on http://localhost:${port}`);
    if (mcpUrl) {
      console.log(`\u{1F4E1} Auto-connecting to: ${mcpUrl}`);
    }
    try {
      await open(`http://localhost:${port}/inspector`);
      console.log(`\u{1F310} Browser opened`);
    } catch {
      console.log(
        `\u{1F310} Please open http://localhost:${port}/inspector in your browser`
      );
    }
    return { port, fetch: app.fetch };
  } catch (error) {
    console.error("Failed to start server:", error);
    process.exit(1);
  }
}
startServer();
