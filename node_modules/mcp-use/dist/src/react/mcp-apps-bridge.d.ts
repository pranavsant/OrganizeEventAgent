/**
 * MCP Apps Bridge - Lightweight postMessage bridge for MCP Apps protocol (SEP-1865)
 * Handles JSON-RPC communication between widget iframe and MCP Apps host
 */
import type { DisplayMode, Theme } from "./widget-types.js";
interface HostContext {
    theme?: Theme;
    displayMode?: DisplayMode;
    containerDimensions?: {
        width?: number;
        height?: number;
        maxWidth?: number;
        maxHeight?: number;
    };
    locale?: string;
    timeZone?: string;
    platform?: "web" | "desktop" | "mobile";
    userAgent?: string;
    deviceCapabilities?: {
        touch?: boolean;
        hover?: boolean;
    };
    safeAreaInsets?: {
        top: number;
        right: number;
        bottom: number;
        left: number;
    };
    styles?: {
        variables?: Record<string, string>;
        css?: {
            fonts?: string;
        };
    };
}
interface ToolInputNotification {
    arguments: Record<string, unknown>;
}
interface ToolInputPartialNotification {
    arguments: Record<string, unknown>;
}
interface ToolResultNotification {
    content?: Array<{
        type: string;
        text?: string;
        [key: string]: unknown;
    }>;
    structuredContent?: Record<string, unknown>;
    isError?: boolean;
    _meta?: Record<string, unknown>;
}
/**
 * Singleton bridge for MCP Apps postMessage communication
 */
declare class McpAppsBridge {
    private connected;
    private connectPromise;
    private requestId;
    private pendingRequests;
    private listeners;
    private toolInput;
    private partialToolInput;
    private toolOutput;
    private toolResponseMetadata;
    private hostContext;
    private initialized;
    private toolInputHandlers;
    private toolInputPartialHandlers;
    private toolResultHandlers;
    private hostContextHandlers;
    constructor();
    /**
     * Intercept console methods and proxy to MCP Apps host
     */
    private interceptConsole;
    private handleNotification;
    private parseTextContent;
    private sendRequest;
    private sendNotification;
    /**
     * Initialize connection with MCP Apps host.
     * Concurrent calls share the same in-flight connection attempt so that
     * React StrictMode double-invocations and multiple useWidget() hooks
     * only produce a single ui/initialize request.
     */
    connect(): Promise<void>;
    private doConnect;
    /**
     * Check if connected to MCP Apps host
     */
    isConnected(): boolean;
    /**
     * Get current tool input (props)
     */
    getToolInput(): Record<string, unknown> | null;
    /**
     * Get current partial/streaming tool input
     */
    getPartialToolInput(): Record<string, unknown> | null;
    /**
     * Get current tool output (structuredContent from tool result)
     */
    getToolOutput(): Record<string, unknown> | null;
    /**
     * Get tool response metadata (_meta from tool result)
     */
    getToolResponseMetadata(): Record<string, unknown> | null;
    /**
     * Get host context
     */
    getHostContext(): HostContext | null;
    /**
     * Subscribe to tool input changes
     */
    onToolInput(handler: (input: Record<string, unknown>) => void): () => void;
    /**
     * Subscribe to partial/streaming tool input changes
     */
    onToolInputPartial(handler: (input: Record<string, unknown>) => void): () => void;
    /**
     * Subscribe to tool result changes
     */
    onToolResult(handler: (result: Record<string, unknown>) => void): () => void;
    /**
     * Subscribe to host context changes
     */
    onHostContextChange(handler: (context: HostContext) => void): () => void;
    /**
     * Call a tool on the server
     */
    callTool(name: string, args: Record<string, unknown>): Promise<unknown>;
    /**
     * Send a message to the conversation
     */
    sendMessage(content: {
        type: string;
        text: string;
    }): Promise<void>;
    /**
     * Open an external link
     */
    openLink(url: string): Promise<void>;
    /**
     * Request display mode change
     */
    requestDisplayMode(mode: DisplayMode): Promise<{
        mode: DisplayMode;
    }>;
    /**
     * Update the host's model context (SEP-1865 ui/update-model-context).
     * The host will include this data in the model's context on future turns.
     * Each call overwrites the previous context.
     */
    updateModelContext(params: {
        content?: Array<{
            type: string;
            text: string;
        }>;
        structuredContent?: Record<string, unknown>;
    }): Promise<void>;
    /**
     * Notify host about size changes for auto-sizing
     * Sends ui/notifications/size-changed notification per SEP-1865
     */
    sendSizeChanged(params: {
        width?: number;
        height?: number;
    }): void;
    /**
     * Cleanup
     */
    disconnect(): void;
}
/**
 * Get or create the MCP Apps bridge singleton
 */
export declare function getMcpAppsBridge(): McpAppsBridge;
/**
 * Type exports
 */
export type { HostContext, ToolInputNotification, ToolInputPartialNotification, ToolResultNotification, };
//# sourceMappingURL=mcp-apps-bridge.d.ts.map